<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#0b0f1a" />
  <title>DLV â€” Menu</title>
  <link rel="icon" href="logo.png"/>
  <link rel="stylesheet" href="base.css">
</head>
<body>
  <div class="app">
    <!-- Header -->
    <header class="header">
      <div class="bar">
        <h1 class="brand" id="brandTap"> <img class="mark" src="logo.png" alt="Logo"> asian food</h1>
        <div class="lang">
          <select id="langSel" aria-label="Language">
            <option value="ru">ğŸ‡·ğŸ‡º RU</option>
            <option value="en">ğŸ‡¬ğŸ‡§ EN</option>
            <option value="ua">ğŸ‡ºğŸ‡¦ UA</option>
            <option value="vn">ğŸ‡»ğŸ‡³ VN</option>
            <option value="pl">ğŸ‡µğŸ‡± PL</option>
            <option value="de">ğŸ‡©ğŸ‡ª DE</option>
            <option value="zh">ğŸ‡¨ğŸ‡³ ZH</option>
          </select>
        </div>
        <button class="burger" id="burgerBtn" aria-haspopup="true" aria-expanded="false" aria-controls="navPop">â˜°</button>
        <nav class="nav-pop" id="navPop" role="menu" aria-label="Main menu">
          <a href="index.html" id="navHome" role="menuitem">ğŸ  HOME</a>
          <a href="#" id="navMenu" role="menuitem">ğŸœ MENU</a>
          <a href="#" id="navKaraoke" role="menuitem">ğŸ¤ KARAOKE</a>
          <a href="#" id="navContact" role="menuitem">ğŸ“ CONTACT</a>
          <hr>
          <div class="lang-inline" role="none">ğŸŒ
            <select id="langSelMenu" aria-label="Language (menu)">
              <option value="ru">ğŸ‡·ğŸ‡º RU</option>
              <option value="en">ğŸ‡¬ğŸ‡§ EN</option>
              <option value="ua">ğŸ‡ºğŸ‡¦ UA</option>
              <option value="vn">ğŸ‡»ğŸ‡³ VN</option>
              <option value="pl">ğŸ‡µğŸ‡± PL</option>
              <option value="de">ğŸ‡©ğŸ‡ª DE</option>
              <option value="zh">ğŸ‡¨ğŸ‡³ ZH</option>
            </select>
          </div>
        </nav>
      </div>
    </header>

    <div class="hero">
      <video
        class="promo"
        src="promo.mp4"
        autoplay
        muted
        loop
        playsinline
        preload="auto"
      ></video>
      
      <div class="social">
        <a href="4441111166306294/" class="social-link" target="_blank" rel="noopener noreferrer" aria-label="monobank">
          <img src="images/icon/mono.png" alt="monobank">
        </a>
        <a href="https://www.instagram.com/cyber_dragon_ua/" class="social-link" target="_blank" rel="noopener noreferrer" aria-label="Instagram">
          <img src="images/icon/ig.png" alt="Instagram">
        </a>
        <a href="https://www.whatsapp.com/?lang=ru_RU" class="social-link" target="_blank" rel="noopener noreferrer" aria-label="WhatsApp">
          <img src="images/icon/wa.png" alt="WhatsApp">
        </a>
        <a href="https://www.tiktok.com/" class="social-link" target="_blank" rel="noopener noreferrer" aria-label="TikTok">
          <img src="images/icon/tt.png" alt="TikTok">
        </a>
      </div>
    </div>

    <!-- Category pills -->
    <nav class="cat-nav glass-nav">
      <div class="h-scroll" id="catPills" aria-label="Categories"></div>
    </nav>

    <!-- Top tools: search + order status -->
    <div class="top-tools">
      <div class="searchbar glass">
        <span class="icon">ğŸ”</span>
        <input id="searchIn" type="search" placeholder="ĞŸĞ¾Ğ¸ÑĞº Ğ±Ğ»ÑĞ´Ğ° / Searchâ€¦" autocomplete="off" />
        <button class="icon-btn" id="searchClear" aria-label="Clear">âœ•</button>
      </div>

      <div class="statusbar glass">
        <span class="icon">ğŸ“¦</span>
        <input id="statusCode" type="text" placeholder="ĞšĞ¾Ğ´ Ğ·Ğ°ĞºĞ°Ğ·Ğ° (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, a123)" autocomplete="off" />
        <button class="btn mini" id="statusBtn">Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ</button>
      </div>

      <div class="status-result" id="statusResult" aria-live="polite"></div>
    </div>

    <main id="content"></main>

    <!-- All categories sheet -->
    <div class="overlay" id="catOverlay"></div>
    <div class="sheet" id="catSheet" role="dialog" aria-modal="true" aria-labelledby="catSheetTitle">
      <div class="sheet-handle" aria-hidden="true"></div>
      <button class="sheet-close" id="catSheetClose" aria-label="Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ">âœ•</button>
      <h3 id="catSheetTitle">ĞšĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸</h3>
      <div class="group" id="catSheetList"></div>
    </div>

    <!-- iOS-style Bottom Dock -->
    <nav class="dock" aria-label="Bottom navigation">
      <button class="dock-btn" id="dockCat" data-label="Menu">
        <img src="DockIconMenu.png" alt="Menu">
      </button>
      <button class="dock-btn" id="dockLang" data-label="Lang">
        <img src="DockIconLang.png" alt="Language">
        <span class="cart-badge" id="dockLangFlag">ğŸ‡·ğŸ‡º</span>
      </button>
      <button class="dock-btn" id="dockCart" data-label="Cart">
        <img src="DockIconKorzina.png" alt="Cart">
        <span class="cart-badge" id="cartBadge">0</span>
      </button>
      <button class="dock-btn" id="dockView" data-label="View">
        <img src="DockIconWien.png" alt="View">
      </button>
      <button class="dock-btn" id="dockMore" data-label="More">
        <img src="DockIconMore.png" alt="More">
      </button>
    </nav>

    <!-- Mini language popup -->
    <div class="mini-popup mini-popup-lang" id="langPopup">
      <button data-lang="ru">ğŸ‡·ğŸ‡º RU</button>
      <button data-lang="en">ğŸ‡¬ğŸ‡§ EN</button>
      <button data-lang="ua">ğŸ‡ºğŸ‡¦ UA</button>
      <button data-lang="vn">ğŸ‡»ğŸ‡³ VN</button>
      <button data-lang="pl">ğŸ‡µğŸ‡± PL</button>
      <button data-lang="de">ğŸ‡©ğŸ‡ª DE</button>
      <button data-lang="zh">ğŸ‡¨ğŸ‡³ ZH</button>
    </div>

    <!-- Cart Bottom Sheet -->
    <div class="overlay" id="overlay"></div>
    <div class="sheet" id="sheet" role="dialog" aria-modal="true" aria-labelledby="sheetTitle">
      <div class="sheet-handle" aria-hidden="true"></div>
      <button class="sheet-close" id="sheetClose" aria-label="Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ">âœ•</button>
      <h3 id="sheetTitle">Ğ’Ğ°Ñˆ Ğ·Ğ°ĞºĞ°Ğ·</h3>
      <div class="cart-lines" id="cartLines"></div>

      <div class="section">
        <div class="muted" id="orderTypeTitle" style="margin-bottom:6px">Ğ¢Ğ¸Ğ¿ Ğ·Ğ°ĞºĞ°Ğ·Ğ°</div>
        <div class="group" id="orderType">
          <button class="chip active" data-ot="on_site" id="otOnSite">ĞĞ° Ğ¼ĞµÑÑ‚Ğµ</button>
          <button class="chip" data-ot="takeaway" id="otTakeaway">ĞĞ° Ğ²Ñ‹Ğ½Ğ¾Ñ</button>
          <button class="chip" data-ot="delivery" id="otDelivery">Ğ”Ğ¾ÑÑ‚Ğ°Ğ²ĞºĞ°</button>
        </div>

        <div class="field" id="tableField" style="display:grid">
          <label for="tableNo" id="tableLbl">Ğ¡Ñ‚Ğ¾Ğ» <span class="muted" id="tableHint">(Ğ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾)</span></label>
          <input id="tableNo" type="number" min="1" inputmode="numeric" placeholder="ĞĞ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, 5">
        </div>

        <div class="field" id="takeawayField" style="display:none">
          <label for="pickupIn" id="pickupLbl">Ğ§ĞµÑ€ĞµĞ· ÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ·Ğ°Ğ±Ñ€Ğ°Ñ‚ÑŒ (Ğ¼Ğ¸Ğ½) <span class="muted" id="pickupHint">(Ğ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾)</span></label>
          <input id="pickupIn" type="number" min="5" step="5" placeholder="15">
        </div>

        <div class="field" id="addrField" style="display:none">
          <label for="address" id="addrLbl">ĞĞ´Ñ€ĞµÑ Ğ´Ğ¾ÑÑ‚Ğ°Ğ²ĞºĞ¸ <span class="muted" id="addrHint">(Ğ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾)</span></label>
          <textarea id="address" placeholder="Ğ“Ğ¾Ñ€Ğ¾Ğ´, ÑƒĞ»Ğ¸Ñ†Ğ°, Ğ´Ğ¾Ğ¼, Ğ¿Ğ¾Ğ´ÑŠĞµĞ·Ğ´..."></textarea>
        </div>

        <div class="field" id="phoneField">
          <label for="phone" id="phoneLbl">Ğ¢ĞµĞ»ĞµÑ„Ğ¾Ğ½ <span class="muted" id="phoneHint">(Ğ½ĞµĞ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾)</span></label>
          <input id="phone" type="tel" placeholder="+380 63 000 00 00">
        </div>
      </div>

      <div class="checkout">
        <div class="muted" id="cartMeta">Ğ˜Ñ‚Ğ¾Ğ³Ğ¾: 0.00 Ğ³Ñ€Ğ½</div>
        <button class="btn primary" id="checkoutBtn">ĞÑ„Ğ¾Ñ€Ğ¼Ğ¸Ñ‚ÑŒ</button>
        <button class="btn ghost" id="clearBtn">ĞÑ‡Ğ¸ÑÑ‚Ğ¸Ñ‚ÑŒ ĞºĞ¾Ñ€Ğ·Ğ¸Ğ½Ñƒ</button>
      </div>
    </div>

    <!-- Dish Details Sheet -->
    <div class="overlay" id="dishOverlay"></div>
    <div class="sheet dish-sheet" id="dishSheet" role="dialog" aria-modal="true" aria-labelledby="dishTitle">
      <div class="sheet-handle" aria-hidden="true"></div>
      <button class="sheet-close" id="dishClose" aria-label="Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ">âœ•</button>

      <div class="dish-head">
        <div class="dish-title">
          <h3 id="dishTitle">â€”</h3>
          <div class="muted" id="dishSub">â€”</div>
        </div>
        <div class="dish-price" id="dishPrice">0.00 Ğ³Ñ€Ğ½</div>
      </div>

      <div class="dish-media" id="dishMedia"></div>

      <div class="dish-body">
        <div class="dish-desc" id="dishDesc">â€”</div>
        <div class="dish-options" id="dishOptions"></div>
        <div class="dish-note">
          <label for="dishNote" class="muted">ĞšĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ¹</label>
          <textarea id="dishNote" placeholder="ĞĞ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€: Ğ±ĞµĞ· Ğ»ÑƒĞºĞ°, Ğ±Ğ¾Ğ»ÑŒÑˆĞµ ÑĞ¾ÑƒÑĞ°â€¦"></textarea>
        </div>
      </div>

      <div class="dish-actions">
        <button class="btn ghost" id="dishMinus">âˆ’</button>
        <div class="dish-qty" id="dishQty">0</div>
        <button class="btn ghost" id="dishPlus">+</button>
        <button class="btn primary" id="dishAddBtn">Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ</button>
      </div>
    </div>

    <!-- DATA -->
    <script src="menu.js"></script>
    <script>
    /* ==== DATA BIND (robust global) ==== */
    const MENU = window.MENU || (typeof menuData !== 'undefined' ? menuData : null);
    if (!MENU) {
      console.error('Menu data is missing. Make sure menu.js is loaded before index script and exposes window.MENU');
    }

    /* ==== LANG & I18N ==== */
    const LANG_KEY = 'CD_LANG';
    let LANG = localStorage.getItem(LANG_KEY) || 'ru';
    document.documentElement.lang = LANG;
    const LANGS_ORDER = ['ru','en','ua','vn','pl','de','zh'];
    const LANG_FLAGS = { ru:'ğŸ‡·ğŸ‡º', en:'ğŸ‡¬ğŸ‡§', ua:'ğŸ‡ºğŸ‡¦', vn:'ğŸ‡»ğŸ‡³', pl:'ğŸ‡µğŸ‡±', de:'ğŸ‡©ğŸ‡ª', zh:'ğŸ‡¨ğŸ‡³' };

    // === Google Sheets API (Apps Script) ===
    const API_BASE = "https://script.google.com/macros/s/AKfycbywwekrmdJvCnKuXKXY-D1_fkJDNm6ES9xAsptqRpoCOS6u9QidiSnGizIK0wybcGTl/exec";

    const I18N = {
      ru:{
        navHome:'Ğ“Ğ»Ğ°Ğ²Ğ½Ğ°Ñ',navMenu:'ĞœĞµĞ½Ñ',navKaraoke:'ĞšĞ°Ñ€Ğ°Ğ¾ĞºĞµ',navContact:'ĞšĞ¾Ğ½Ñ‚Ğ°ĞºÑ‚Ñ‹',
        ui:{
          add:'Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ',more:'ĞŸĞ¾Ğ´Ñ€Ğ¾Ğ±Ğ½ĞµĞµ',itemsShort:'ÑˆÑ‚.',viewList:'Ğ’Ğ¸Ğ´ ÑĞ¿Ğ¸ÑĞºĞ¾Ğ¼',viewGrid:'Ğ’Ğ¸Ğ´ ÑĞµÑ‚ĞºĞ¾Ğ¹',
          universalShort:'ĞšĞ»Ğ°ÑÑĞ¸ĞºĞ° Ğ²ÑŒĞµÑ‚Ğ½Ğ°Ğ¼ÑĞºĞ¾Ğ¹ ĞºÑƒÑ…Ğ½Ğ¸. ĞœĞ¾Ğ¶Ğ½Ğ¾ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ: gÃ  / bÃ² / heo / tÃ´m.'
        },
        sheet:{
          title:'Ğ’Ğ°Ñˆ Ğ·Ğ°ĞºĞ°Ğ·',empty:'ĞšĞ¾Ñ€Ğ·Ğ¸Ğ½Ğ° Ğ¿ÑƒÑÑ‚Ğ°.',orderType:'Ğ¢Ğ¸Ğ¿ Ğ·Ğ°ĞºĞ°Ğ·Ğ°',
          onSite:'ĞĞ° Ğ¼ĞµÑÑ‚Ğµ',takeaway:'ĞĞ° Ğ²Ñ‹Ğ½Ğ¾Ñ',delivery:'Ğ”Ğ¾ÑÑ‚Ğ°Ğ²ĞºĞ°',
          table:'Ğ¡Ñ‚Ğ¾Ğ»',pickupIn:'Ğ§ĞµÑ€ĞµĞ· ÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ·Ğ°Ğ±Ñ€Ğ°Ñ‚ÑŒ (Ğ¼Ğ¸Ğ½)',address:'ĞĞ´Ñ€ĞµÑ Ğ´Ğ¾ÑÑ‚Ğ°Ğ²ĞºĞ¸',phone:'Ğ¢ĞµĞ»ĞµÑ„Ğ¾Ğ½',
          phTable:'ĞĞ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, 5',phPickup:'15',phAddress:'Ğ“Ğ¾Ñ€Ğ¾Ğ´, ÑƒĞ»Ğ¸Ñ†Ğ°, Ğ´Ğ¾Ğ¼, Ğ¿Ğ¾Ğ´ÑŠĞµĞ·Ğ´...',phPhone:'+380 63 000 00 00',
          total:'Ğ˜Ñ‚Ğ¾Ğ³Ğ¾',checkout:'ĞÑ„Ğ¾Ñ€Ğ¼Ğ¸Ñ‚ÑŒ',clear:'ĞÑ‡Ğ¸ÑÑ‚Ğ¸Ñ‚ÑŒ ĞºĞ¾Ñ€Ğ·Ğ¸Ğ½Ñƒ',
          errTable:'Ğ£ĞºĞ°Ğ¶Ğ¸Ñ‚Ğµ Ğ½Ğ¾Ğ¼ĞµÑ€ ÑÑ‚Ğ¾Ğ»Ğ°.',errPickup:'Ğ£ĞºĞ°Ğ¶Ğ¸Ñ‚Ğµ Ñ‡ĞµÑ€ĞµĞ· ÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ¼Ğ¸Ğ½ÑƒÑ‚ Ğ·Ğ°Ğ±Ñ€Ğ°Ñ‚ÑŒ.',
          errPhone:'Ğ£ĞºĞ°Ğ¶Ğ¸Ñ‚Ğµ Ñ‚ĞµĞ»ĞµÑ„Ğ¾Ğ½.',errAddress:'Ğ£ĞºĞ°Ğ¶Ğ¸Ñ‚Ğµ Ğ°Ğ´Ñ€ĞµÑ Ğ´Ğ¾ÑÑ‚Ğ°Ğ²ĞºĞ¸.'
        },
        common:{required:'(Ğ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾)',optional:'(Ğ½ĞµĞ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾)'},
        tabbar:{menu:'ĞœĞµĞ½Ñ',lang:'Ğ¯Ğ·Ñ‹Ğº',cart:'ĞšĞ¾Ñ€Ğ·Ğ¸Ğ½Ğ°',more:'Ğ•Ñ‰Ñ‘'}
      },
      en:{
        navHome:'Home',navMenu:'Menu',navKaraoke:'Karaoke',navContact:'Contact',
        ui:{
          add:'Add',more:'More',itemsShort:'pcs',viewList:'List view',viewGrid:'Grid view',
          universalShort:'Vietnamese classic. You can add: chicken / beef / pork / shrimp.'
        },
        sheet:{
          title:'Your order',empty:'Cart is empty.',orderType:'Order type',
          onSite:'Dine-in',takeaway:'Takeaway',delivery:'Delivery',
          table:'Table',pickupIn:'Pickup in (min)',address:'Delivery address',phone:'Phone',
          phTable:'e.g., 5',phPickup:'15',phAddress:'City, street, houseâ€¦',phPhone:'+380 63 000 00 00',
          total:'Total',checkout:'Checkout',clear:'Clear cart',
          errTable:'Please enter table number.',errPickup:'Please enter pickup time (min).',
          errPhone:'Please enter phone.',errAddress:'Please enter delivery address.'
        },
        common:{required:'(required)',optional:'(optional)'},
        tabbar:{menu:'Menu',lang:'Lang',cart:'Cart',more:'More'}
      },
      ua:{
        navHome:'Ğ“Ğ¾Ğ»Ğ¾Ğ²Ğ½Ğ°',navMenu:'ĞœĞµĞ½Ñ',navKaraoke:'ĞšĞ°Ñ€Ğ°Ğ¾ĞºĞµ',navContact:'ĞšĞ¾Ğ½Ñ‚Ğ°ĞºÑ‚Ğ¸',
        ui:{
          add:'Ğ”Ğ¾Ğ´Ğ°Ñ‚Ğ¸',more:'Ğ”Ğ¾ĞºĞ»Ğ°Ğ´Ğ½Ñ–ÑˆĞµ',itemsShort:'ÑˆÑ‚.',viewList:'Ğ’Ğ¸Ğ³Ğ»ÑĞ´ ÑĞ¿Ğ¸ÑĞºĞ¾Ğ¼',viewGrid:'Ğ’Ğ¸Ğ³Ğ»ÑĞ´ ÑÑ–Ñ‚ĞºĞ¾Ñ',
          universalShort:'ĞšĞ»Ğ°ÑĞ¸ĞºĞ° Ğ²â€™Ñ”Ñ‚Ğ½Ğ°Ğ¼ÑÑŒĞºĞ¾Ñ— ĞºÑƒÑ…Ğ½Ñ–. ĞœĞ¾Ğ¶Ğ½Ğ° Ğ´Ğ¾Ğ´Ğ°Ñ‚Ğ¸: gÃ  / bÃ² / heo / tÃ´m.'
        },
        sheet:{
          title:'Ğ’Ğ°ÑˆĞµ Ğ·Ğ°Ğ¼Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ',empty:'ĞšĞ¾ÑˆĞ¸Ğº Ğ¿Ğ¾Ñ€Ğ¾Ğ¶Ğ½Ñ–Ğ¹.',orderType:'Ğ¢Ğ¸Ğ¿ Ğ·Ğ°Ğ¼Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ',
          onSite:'Ğ£ Ğ·Ğ°ĞºĞ»Ğ°Ğ´Ñ–',takeaway:'ĞĞ° Ğ²Ğ¸Ğ½Ñ–Ñ',delivery:'Ğ”Ğ¾ÑÑ‚Ğ°Ğ²ĞºĞ°',
          table:'Ğ¡Ñ‚Ñ–Ğ»',pickupIn:'Ğ§ĞµÑ€ĞµĞ· ÑĞºÑ–Ğ»ÑŒĞºĞ¸ Ğ·Ğ°Ğ±Ñ€Ğ°Ñ‚Ğ¸ (Ñ…Ğ²)',address:'ĞĞ´Ñ€ĞµÑĞ° Ğ´Ğ¾ÑÑ‚Ğ°Ğ²ĞºĞ¸',phone:'Ğ¢ĞµĞ»ĞµÑ„Ğ¾Ğ½',
          phTable:'ĞĞ°Ğ¿Ñ€Ğ¸ĞºĞ»Ğ°Ğ´, 5',phPickup:'15',phAddress:'ĞœÑ–ÑÑ‚Ğ¾, Ğ²ÑƒĞ»Ğ¸Ñ†Ñ, Ğ±ÑƒĞ´Ğ¸Ğ½Ğ¾Ğºâ€¦',phPhone:'+380 63 000 00 00',
          total:'Ğ Ğ°Ğ·Ğ¾Ğ¼',checkout:'ĞÑ„Ğ¾Ñ€Ğ¼Ğ¸Ñ‚Ğ¸',clear:'ĞÑ‡Ğ¸ÑÑ‚Ğ¸Ñ‚Ğ¸ ĞºĞ¾ÑˆĞ¸Ğº',
          errTable:'Ğ’ĞºĞ°Ğ¶Ñ–Ñ‚ÑŒ Ğ½Ğ¾Ğ¼ĞµÑ€ ÑÑ‚Ğ¾Ğ»Ñƒ.',errPickup:'Ğ’ĞºĞ°Ğ¶Ñ–Ñ‚ÑŒ Ñ‡Ğ°Ñ Ğ¾Ñ‚Ñ€Ğ¸Ğ¼Ğ°Ğ½Ğ½Ñ (Ñ…Ğ²).',
          errPhone:'Ğ’ĞºĞ°Ğ¶Ñ–Ñ‚ÑŒ Ñ‚ĞµĞ»ĞµÑ„Ğ¾Ğ½.',errAddress:'Ğ’ĞºĞ°Ğ¶Ñ–Ñ‚ÑŒ Ğ°Ğ´Ñ€ĞµÑÑƒ Ğ´Ğ¾ÑÑ‚Ğ°Ğ²ĞºĞ¸.'
        },
        common:{required:'(Ğ¾Ğ±Ğ¾Ğ²â€™ÑĞ·ĞºĞ¾Ğ²Ğ¾)',optional:'(Ğ½ĞµĞ¾Ğ±Ğ¾Ğ²â€™ÑĞ·ĞºĞ¾Ğ²Ğ¾)'},
        tabbar:{menu:'ĞœĞµĞ½Ñ',lang:'ĞœĞ¾Ğ²Ğ°',cart:'ĞšĞ¾ÑˆĞ¸Ğº',more:'Ğ©Ğµ'}
      },
      pl:{
        navHome:'Start',navMenu:'Menu',navKaraoke:'Karaoke',navContact:'Kontakt',
        ui:{
          add:'Dodaj',more:'SzczegÃ³Å‚y',itemsShort:'szt.',viewList:'Widok listy',viewGrid:'Widok siatki',
          universalShort:'Klasyk kuchni wietnamskiej. MoÅ¼esz dodaÄ‡: kurczak / woÅ‚owina / wieprzowina / krewetki.'
        },
        sheet:{
          title:'Twoje zamÃ³wienie',empty:'Koszyk jest pusty.',orderType:'Rodzaj zamÃ³wienia',
          onSite:'Na miejscu',takeaway:'Na wynos',delivery:'Dostawa',
          table:'StÃ³Å‚',pickupIn:'OdbiÃ³r za (min)',address:'Adres dostawy',phone:'Telefon',
          phTable:'Np. 5',phPickup:'15',phAddress:'Miasto, ulica, nr domuâ€¦',phPhone:'+380 63 000 00 00',
          total:'Suma',checkout:'ZamÃ³w',clear:'WyczyÅ›Ä‡ koszyk',
          errTable:'Podaj numer stoÅ‚u.',errPickup:'Podaj czas odbioru (min).',
          errPhone:'Podaj telefon.',errAddress:'Podaj adres dostawy.'
        },
        common:{required:'(wymagane)',optional:'(opcjonalnie)'},
        tabbar:{menu:'Menu',lang:'JÄ™zyk',cart:'Koszyk',more:'WiÄ™cej'}
      },
      de:{
        navHome:'Start',navMenu:'MenÃ¼',navKaraoke:'Karaoke',navContact:'Kontakt',
        ui:{
          add:'HinzufÃ¼gen',more:'Details',itemsShort:'St.',viewList:'Listenansicht',viewGrid:'Rasteransicht',
          universalShort:'Vietnamesischer Klassiker. Du kannst hinzufÃ¼gen: Huhn / Rind / Schwein / Garnelen.'
        },
        sheet:{
          title:'Ihre Bestellung',empty:'Warenkorb ist leer.',orderType:'Bestellart',
          onSite:'Vor Ort',takeaway:'Zum Mitnehmen',delivery:'Lieferung',
          table:'Tisch',pickupIn:'Abholung in (Min.)',address:'Lieferadresse',phone:'Telefon',
          phTable:'z. B. 5',phPickup:'15',phAddress:'Stadt, StraÃŸe, Nr.â€¦',phPhone:'+380 63 000 00 00',
          total:'Gesamt',checkout:'Bestellen',clear:'Warenkorb leeren',
          errTable:'Bitte Tisch-Nr. eingeben.',errPickup:'Bitte Abholzeit (Min.) eingeben.',
          errPhone:'Bitte Telefon eingeben.',errAddress:'Bitte Lieferadresse eingeben.'
        },
        common:{required:'(erforderlich)',optional:'(optional)'},
        tabbar:{menu:'MenÃ¼',lang:'Sprache',cart:'Warenkorb',more:'Mehr'}
      },
      zh:{
        navHome:'ä¸»é¡µ',navMenu:'èœå•',navKaraoke:'å¡æ‹‰OK',navContact:'è”ç³»',
        ui:{
          add:'æ·»åŠ ',more:'è¯¦æƒ…',itemsShort:'ä»¶',viewList:'åˆ—è¡¨è§†å›¾',viewGrid:'ç½‘æ ¼è§†å›¾',
          universalShort:'è¶Šå—ç»å…¸ã€‚å¯åŠ ï¼šé¸¡/ç‰›/çŒª/è™¾ã€‚'
        },
        sheet:{
          title:'æ‚¨çš„è®¢å•',empty:'è´­ç‰©è½¦ä¸ºç©ºã€‚',orderType:'è®¢å•ç±»å‹',
          onSite:'å ‚é£Ÿ',takeaway:'å¤–å¸¦',delivery:'é…é€',
          table:'æ¡Œå·',pickupIn:'å–é¤æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰',address:'é…é€åœ°å€',phone:'ç”µè¯',
          phTable:'ä¾‹å¦‚ 5',phPickup:'15',phAddress:'åŸå¸‚ã€è¡—é“ã€é—¨ç‰Œâ€¦',phPhone:'+380 63 000 00 00',
          total:'åˆè®¡',checkout:'ä¸‹å•',clear:'æ¸…ç©ºè´­ç‰©è½¦',
          errTable:'è¯·è¾“å…¥æ¡Œå·ã€‚',errPickup:'è¯·è¾“å…¥å–é¤æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰ã€‚',
          errPhone:'è¯·è¾“å…¥ç”µè¯ã€‚',errAddress:'è¯·è¾“å…¥é…é€åœ°å€ã€‚'
        },
        common:{required:'(å¿…å¡«)',optional:'(å¯é€‰)'},
        tabbar:{menu:'èœå•',lang:'è¯­è¨€',cart:'è´­ç‰©è½¦',more:'æ›´å¤š'}
      },
      vn:{
        navHome:'Trang chá»§',navMenu:'Thá»±c Ä‘Æ¡n',navKaraoke:'Karaoke',navContact:'LiÃªn há»‡',
        ui:{
          add:'ThÃªm',more:'Chi tiáº¿t',itemsShort:'mÃ³n',viewList:'Dáº¡ng danh sÃ¡ch',viewGrid:'Dáº¡ng lÆ°á»›i',
          universalShort:'MÃ³n Viá»‡t cÆ¡ báº£n. CÃ³ thá»ƒ thÃªm: gÃ  / bÃ² / heo / tÃ´m.'
        },
        sheet:{
          title:'ÄÆ¡n hÃ ng cá»§a báº¡n',empty:'Giá» hÃ ng trá»‘ng.',orderType:'HÃ¬nh thá»©c Ä‘áº·t',
          onSite:'Ä‚n táº¡i chá»—',takeaway:'Mang Ä‘i',delivery:'Giao hÃ ng',
          table:'BÃ n',pickupIn:'Nháº­n sau (phÃºt)',address:'Äá»‹a chá»‰ giao hÃ ng',phone:'Äiá»‡n thoáº¡i',
          phTable:'VÃ­ dá»¥: 5',phPickup:'15',phAddress:'ThÃ nh phá»‘, Ä‘Æ°á»ng, sá»‘ nhÃ â€¦',phPhone:'+380 63 000 00 00',
          total:'Tá»•ng cá»™ng',checkout:'Äáº·t hÃ ng',clear:'XÃ³a giá» hÃ ng',
          errTable:'Vui lÃ²ng nháº­p sá»‘ bÃ n.',errPickup:'Vui lÃ²ng nháº­p thá»i gian nháº­n (phÃºt).',
          errPhone:'Vui lÃ²ng nháº­p sá»‘ Ä‘iá»‡n thoáº¡i.',errAddress:'Vui lÃ²ng nháº­p Ä‘á»‹a chá»‰ giao hÃ ng.'
        },
        common:{required:'(báº¯t buá»™c)',optional:'(khÃ´ng báº¯t buá»™c)'},
        tabbar:{menu:'Thá»±c Ä‘Æ¡n',lang:'NgÃ´n ngá»¯',cart:'Giá»',more:'ThÃªm'}
      }
    };

    const L = () => I18N[LANG] || I18N.en;

    /* Descriptions lazy-load */
    let DESCS = null;
    async function loadDescriptions(){
      if (DESCS) return DESCS;
      try{
        if (location.protocol === 'file:'){
          const node = document.getElementById('descriptions-embedded');
          if (node && node.textContent && node.textContent.trim()){
            DESCS = JSON.parse(node.textContent);
            return DESCS;
          }
        }
      }catch(e){}
      try{
        const resp = await fetch('descriptions.json', {cache:'no-store'});
        if (resp.ok){
          DESCS = await resp.json();
          return DESCS;
        }
      }catch(e){
        console.warn('Descriptions unavailable (using menu short only).');
      }
      DESCS = {};
      return DESCS;
    }

    /* Category labels â€” UPDATED to match NEW menu.js keys */
    const CAT_LABELS = {
      "pho_soups": {"ru":"Ğ¡ÑƒĞ¿Ñ‹ Ğ¤Ğ¾","ua":"Ğ¡ÑƒĞ¿Ğ¸ Ğ¤Ğ¾","en":"Pho Soups","vn":"Phá»Ÿ (sÃºp)","pl":"Zupy Pho","de":"Pho-Suppen","zh":"æ²³ç²‰æ±¤"},
      "bun_soups": {"ru":"Ğ¡ÑƒĞ¿Ñ‹ Ğ‘ÑƒĞ½","ua":"Ğ¡ÑƒĞ¿Ğ¸ Ğ‘ÑƒĞ½","en":"Bun Soups","vn":"BÃºn (sÃºp)","pl":"Zupy BÃºn","de":"BÃºn-Suppen","zh":"ç±³ç²‰æ±¤"},
      "cold_bun": {"ru":"Ğ¥Ğ¾Ğ»Ğ¾Ğ´Ğ½Ñ‹Ğ¹ Ğ‘ÑƒĞ½","ua":"Ğ¥Ğ¾Ğ»Ğ¾Ğ´Ğ½Ğ¸Ğ¹ Ğ‘ÑƒĞ½","en":"Cold Bun","vn":"BÃºn Nam Bá»™","pl":"BÃºn na zimno","de":"Kalter BÃºn","zh":"å†·æ‹Œç±³ç²‰"},
      "mien_soups": {"ru":"Ğ¡ÑƒĞ¿Ñ‹ ĞœĞ¸ĞµĞ½","ua":"Ğ¡ÑƒĞ¿Ğ¸ ĞœÑ–Ñ”Ğ½","en":"Mien Soups","vn":"Miáº¿n (sÃºp)","pl":"Zupy Miáº¿n","de":"Miáº¿n-Suppen","zh":"ç²‰ä¸æ±¤"},
      "mi_soups": {"ru":"Ğ¡ÑƒĞ¿Ñ‹ ĞœĞ¸","ua":"Ğ¡ÑƒĞ¿Ğ¸ MÃ¬","en":"Mi Soups","vn":"MÃ¬ (sÃºp)","pl":"Zupy MÃ¬","de":"MÃ¬-Suppen","zh":"é¢æ±¤"},
      "wok_fried_pho": {"ru":"WOK Phá»Ÿ xÃ o","ua":"WOK Phá»Ÿ xÃ o","en":"WOK Fried Pho","vn":"Phá»Ÿ xÃ o (WOK)","pl":"Pho z woka","de":"WOK-Pho","zh":"ç‚’æ²³ç²‰"},
      "wok_fried_mien": {"ru":"WOK Miáº¿n xÃ o","ua":"WOK Miáº¿n xÃ o","en":"WOK Fried Mien","vn":"Miáº¿n xÃ o (WOK)","pl":"Miáº¿n z woka","de":"WOK-Miáº¿n","zh":"ç‚’ç²‰ä¸"},
      "wok_fried_mi": {"ru":"WOK MÃ¬ xÃ o","ua":"WOK MÃ¬ xÃ o","en":"WOK Fried Mi","vn":"MÃ¬ xÃ o (WOK)","pl":"MÃ¬ z woka","de":"WOK-MÃ¬","zh":"ç‚’é¢"},
      "rice_braised": {"ru":"Ğ Ğ¸Ñ Ñ‚ÑƒÑˆÑ‘Ğ½Ñ‹Ğ¹","ua":"Ğ¢ÑƒÑˆĞºĞ¾Ğ²Ğ°Ğ½Ğ¸Ğ¹ Ñ€Ğ¸Ñ","en":"Braised Rice","vn":"CÆ¡m thá»‹t kho","pl":"RyÅ¼ duszony","de":"Geschmorter Reis","zh":"å¤è‚‰é¥­"},
      "fried_rice": {"ru":"Ğ–Ğ°Ñ€ĞµĞ½Ñ‹Ğ¹ Ñ€Ğ¸Ñ","ua":"Ğ¡Ğ¼Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¹ Ñ€Ğ¸Ñ","en":"Fried Rice","vn":"CÆ¡m rang","pl":"SmaÅ¼ony ryÅ¼","de":"Gebratener Reis","zh":"ç‚’é¥­"},
      "appetizers": {"ru":"Ğ—Ğ°ĞºÑƒÑĞºĞ¸","ua":"Ğ—Ğ°ĞºÑƒÑĞºĞ¸","en":"Appetizers","vn":"Khai vá»‹","pl":"Przystawki","de":"Vorspeisen","zh":"å°åƒ"},
      "drinks": {"ru":"ĞĞ°Ğ¿Ğ¸Ñ‚ĞºĞ¸","ua":"ĞĞ°Ğ¿Ğ¾Ñ—","en":"Drinks","vn":"Äá»“ uá»‘ng","pl":"Napoje","de":"GetrÃ¤nke","zh":"é¥®æ–™"}
    };

    const catLabel = k => (CAT_LABELS[k]?.[LANG] || CAT_LABELS[k]?.en || k);

    /* Helpers & state */
    const $ = s => document.querySelector(s);
    const $$ = s => document.querySelectorAll(s);
    const CURRENCY = 'Ğ³Ñ€Ğ½';
    const IMG_DIR = 'images/';
    const IMG_EXTS = ['webp','jpg','jpeg','png'];
    const fmt = n => Number(n).toFixed(2) + ' ' + CURRENCY;

    // --- i18n safe text picker ---
    function pickLang(val, lang = LANG){
      if (val === null || val === undefined) return '';
      const type = typeof val;
      if (type === 'string' || type === 'number' || type === 'boolean') return String(val);
      if (Array.isArray(val)){
        return val.map(v => pickLang(v, lang)).filter(Boolean).join(', ');
      }
      if (type === 'object'){
        if (val.description && typeof val.description === 'object') return pickLang(val.description, lang);
        if (val[lang] !== undefined) return pickLang(val[lang], lang);
        if (val.en !== undefined) return pickLang(val.en, lang);
        if (val.ru !== undefined) return pickLang(val.ru, lang);
        if (val.ua !== undefined) return pickLang(val.ua, lang);
        if (val.vn !== undefined) return pickLang(val.vn, lang);
        for (const k of Object.keys(val)){
          const v = val[k];
          if (typeof v === 'string' || typeof v === 'number' || typeof v === 'boolean') return String(v);
        }
        return '';
      }
      return String(val);
    }

    function vnPrettyTuyChon(text, it, extraHint=''){
      if (LANG !== 'vn') return text;
      const base = (text || '').trim();
      const norm = base.toLowerCase();
      if (!(norm === 'tá»± chá»n' || norm === 'tu chon' || norm === 'tuy chon')) return base;
      const key = String(it?.key || '').toLowerCase();
      const hint = String(extraHint || '').toLowerCase();
      const hay = `${key} ${hint}`;
      if (/sot|sá»‘t|sauce/.test(hay)) return 'Chá»n sá»‘t theo Ã½ báº¡n';
      if (/pho/.test(hay)) return 'Tá»± táº¡o tÃ´ Phá»Ÿ theo Ã½ báº¡n';
      if (/bun/.test(hay)) return 'Tá»± táº¡o tÃ´ BÃºn theo Ã½ báº¡n';
      if (/mien|miáº¿n/.test(hay)) return 'Tá»± táº¡o tÃ´ Miáº¿n theo Ã½ báº¡n';
      return base;
    }

    const escapeHtml = (s='') => String(pickLang(s))
      .replaceAll('&','&amp;')
      .replaceAll('<','&lt;')
      .replaceAll('>','&gt;')
      .replaceAll('"','&quot;')
      .replaceAll("'","&#039;");

    function summarizeSelections(it, selections){
      const opts = normalizeOptions(it);
      const sel = selections || {};
      const parts = [];
      for (const g of opts){
        const gid = g.id || g.key || g.name || '';
        const picked = sel[gid];
        if (!picked) continue;
        const pickArr = Array.isArray(picked) ? picked : [picked];
        const names = pickArr.map(oid=>{
          const item = (g.items||[]).find(x => (x.id||x.key)===oid);
          const nm = optionLabel(item || {id:oid, label:oid});
          const d = Number(item?.price_delta||0);
          return d ? `${nm} (+${d})` : `${nm}`;
        });
        const gTitle = groupTitleSmart(g, it);
        parts.push(gTitle ? `${gTitle}: ${names.join(', ')}` : names.join(', '));
      }
      return parts.join(' Â· ');
    }

    function summarizeSelectionsLines(it, selections){
      const opts = normalizeOptions(it);
      const sel = selections || {};
      const lines = [];
      for (const g of opts){
        const gid = g.id || g.key || g.name || '';
        const picked = sel[gid];
        if (!picked) continue;
        const pickArr = Array.isArray(picked) ? picked : [picked];
        const names = pickArr.map(oid=>{
          const item = (g.items||[]).find(x => (x.id||x.key)===oid);
          return optionLabel(item || {id:oid, label:oid});
        });
        const gTitle = groupTitleSmart(g, it) || gid;
        lines.push(`${gTitle}: ${names.join(', ')}`);
      }
      return lines;
    }

    function buildThumb(imgEl, key){
      let i = 0;
      const trySet = () => imgEl.src = IMG_DIR + key + '.' + IMG_EXTS[i];
      imgEl.onerror = () => {
        i++;
        if (i < IMG_EXTS.length){
          trySet();
        } else {
          imgEl.closest('.thumb')?.classList.add('noimg');
          imgEl.remove();
        }
      };
      trySet();
    }

    const itemName = it => {
      const base = pickLang(it?.translations) || (it?.key?.replaceAll('_',' ') || '');
      if (LANG === 'vn'){
        const b = (base || '').trim();
        if (/tá»± chá»n/i.test(b) || /tu chon/i.test(b) || /tuy chon/i.test(b)){
          const key = String(it?.key || '').toLowerCase();
          if (key.includes('pho')) return 'Tá»± táº¡o tÃ´ Phá»Ÿ theo Ã½ báº¡n';
          if (key.includes('bun')) return 'Tá»± táº¡o tÃ´ BÃºn theo Ã½ báº¡n';
          if (key.includes('mien') || key.includes('miáº¿n')) return 'Tá»± táº¡o tÃ´ Miáº¿n theo Ã½ báº¡n';
          if (key.includes('sauce') || key.includes('sot') || key.includes('sá»‘t')) return 'Chá»n sá»‘t theo Ã½ báº¡n';
        }
      }
      return base;
    };

    const CART_KEY = 'CD_CART_V2';
    const ORDERS_KEY = 'CD_ORDERS_V1';
    const SEARCH_KEY = 'CD_SEARCH_Q';
    const HERO_KEY = 'CD_HERO_CLOSED';

    // cart: Map(id -> {qty:number, selections:object, note:string})
    const cart = new Map();

    function loadCart(){
      try{
        const raw = localStorage.getItem(CART_KEY);
        if (!raw) return;
        const obj = JSON.parse(raw);
        for (const [id, entry] of Object.entries(obj || {})){
          if (!entry || typeof entry.qty !== 'number') continue;
          cart.set(id, {
            qty: Math.max(0, entry.qty|0),
            selections: entry.selections || {},
            note: entry.note || ''
          });
        }
      }catch(e){ console.warn('Cart load failed', e); }
    }

    function saveCart(){
      try{
        const obj = {};
        for (const [id, entry] of cart){
          obj[id] = entry;
        }
        localStorage.setItem(CART_KEY, JSON.stringify(obj));
      }catch(e){ console.warn('Cart save failed', e); }
    }

    function cartQty(id){ return cart.get(id)?.qty || 0; }

    function cartInc(id, delta=1){
      const cur = cart.get(id) || {qty:0, selections:{}, note:''};
      cur.qty = Math.max(0, (cur.qty|0) + delta);
      if (cur.qty<=0) cart.delete(id); else cart.set(id, cur);
      saveCart();
    }

    function cartSetEntry(id, entry){
      cart.set(id, entry);
      saveCart();
    }

    function loadOrders(){
      try{ return JSON.parse(localStorage.getItem(ORDERS_KEY) || '{}') || {}; }
      catch(e){ return {}; }
    }
    function saveOrders(obj){
      try{ localStorage.setItem(ORDERS_KEY, JSON.stringify(obj||{})); }catch(e){}
    }

    /* Pills */
    function renderPills(){
      const keys = Object.keys(MENU || {});
      const el = $('#catPills');
      if (!el) return;
      el.innerHTML = keys.map((k,i) =>
        `<a class="pill ${i===0?'active':''}" href="#sec-${k}">${catLabel(k)}</a>`
      ).join('');
    }

    /* View toggle (grid/list) */
    const VIEW_KEY = 'CD_VIEW_MENU';
    let viewMode = localStorage.getItem(VIEW_KEY) || 'grid';
    function applyView(){
      $$('.list').forEach(wrap => {
        wrap.classList.toggle('as-list', viewMode === 'list');
      });
    }

    /* Meta info */
    function buildMeta(it){
      if (!it) return '';
      const parts = [];
      if (it.weight) parts.push(it.weight + ' g');
      if (it.kcal) parts.push(it.kcal + ' kcal');
      if (it.spicy){
        const level = Math.max(1, Math.min(3, Number(it.spicy)));
        parts.push('ğŸŒ¶'.repeat(level));
      }
      if (Array.isArray(it.tags) && it.tags.length){
        const mapped = it.tags.map(t=>{
          switch(t){
            case 'vegan': return 'ğŸŒ± vegan';
            case 'veg': return 'ğŸ¥¦ veg';
            case 'no_gluten': return 'ğŸš« gluten';
            case 'chef': return 'â­ chef';
            case 'popular': return 'ğŸ”¥ top';
            default: return t;
          }
        });
        parts.push(mapped.join(' Â· '));
      }
      if (!parts.length) return '';
      return `<div class="meta">${parts.join(' â€¢ ')}</div>`;
    }

    /* Options / pricing â€” UPDATED: universal protein add-on */
    function shouldEnableProteinAddon(it){
      const k = String(it?.key || '').toLowerCase();
      // families: pho, bun, mien, com, com_rang (+ mi optional)
      return /^(pho|bun|mien|mi|com|com_rang)/.test(k);
    }

    function proteinAddonGroup(){
      return {
        id:'add_protein',
        title:{
          ru:'Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¼ÑÑĞ¾/Ğ¼Ğ¾Ñ€ĞµĞ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ñ‹',
          ua:'Ğ”Ğ¾Ğ´Ğ°Ñ‚Ğ¸ Ğ¼â€™ÑÑĞ¾/Ğ¼Ğ¾Ñ€ĞµĞ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ğ¸',
          en:'Add extra protein',
          vn:'ThÃªm Ä‘áº¡m',
          pl:'Dodaj biaÅ‚ko',
          de:'Extra Protein hinzufÃ¼gen',
          zh:'åŠ ä¸»æ–™'
        },
        required:false,
        multi:true,
        max:4,
        items:[
          {id:'ga',  label:{ru:'GÃ  (ĞºÑƒÑ€Ğ¸Ñ†Ğ°)',ua:'GÃ  (ĞºÑƒÑ€ĞºĞ°)',en:'Chicken (gÃ )',vn:'GÃ ',pl:'Kurczak (gÃ )',de:'Huhn (gÃ )',zh:'é¸¡'}, price_delta:30},
          {id:'bo',  label:{ru:'BÃ² (Ğ³Ğ¾Ğ²ÑĞ´Ğ¸Ğ½Ğ°)',ua:'BÃ² (ÑĞ»Ğ¾Ğ²Ğ¸Ñ‡Ğ¸Ğ½Ğ°)',en:'Beef (bÃ²)',vn:'BÃ²',pl:'WoÅ‚owina (bÃ²)',de:'Rind (bÃ²)',zh:'ç‰›'}, price_delta:40},
          {id:'heo', label:{ru:'Heo (ÑĞ²Ğ¸Ğ½Ğ¸Ğ½Ğ°)',ua:'Heo (ÑĞ²Ğ¸Ğ½Ğ¸Ğ½Ğ°)',en:'Pork (heo)',vn:'Heo',pl:'Wieprzowina (heo)',de:'Schwein (heo)',zh:'çŒª'}, price_delta:30},
          {id:'tom', label:{ru:'TÃ´m (ĞºÑ€ĞµĞ²ĞµÑ‚ĞºĞ¸)',ua:'TÃ´m (ĞºÑ€ĞµĞ²ĞµÑ‚ĞºĞ¸)',en:'Shrimp (tÃ´m)',vn:'TÃ´m',pl:'Krewetki (tÃ´m)',de:'Garnelen (tÃ´m)',zh:'è™¾'}, price_delta:50},
        ]
      };
    }

    function normalizeOptions(it){
      const base = Array.isArray(it?.options) ? it.options : [];
      if (!shouldEnableProteinAddon(it)) return base;
      if (base.some(g => (g?.id || g?.key || g?.name) === 'add_protein')) return base;
      return [...base, proteinAddonGroup()];
    }

    function calcItemUnitPrice(it, selections){
      let base = Number(it?.price || 0);
      const opts = normalizeOptions(it);
      const sel = selections || {};
      for (const g of opts){
        const gid = g.id || g.key || g.name || '';
        const picked = sel[gid];
        if (!picked) continue;
        const pickArr = Array.isArray(picked) ? picked : [picked];
        for (const oid of pickArr){
          const found = (g.items || []).find(x => (x.id||x.key) === oid);
          if (found) base += Number(found.price_delta || 0);
        }
      }
      return base;
    }

    function getShortForItem(it){
      // 1) menu.js short/desc
      const base = pickLang(it?.short || it?.desc);
      if (base) return base;

      // 2) descriptions.json
      const key = it?.key || '';
      const entry = key ? DESCS?.[key] : null;
      const fromJson = pickLang(entry?.short || entry?.description);
      if (fromJson) return fromJson;

      // 3) universal fallback
      return (L()?.ui?.universalShort) || '';
    }

    /* Render menu */
    const TOP_KEYS = ["pho_bo", "pho_ga", "bun_bo", "com_rang_bo", "pho_bo_xao", "spring_rolls_fresh", "caphe_viet"];
    function findByKey(key){
      for (const [cat, arr] of Object.entries(MENU||{})){
        const idx = (arr||[]).findIndex(x => x && x.key === key);
        if (idx >= 0) return {cat, idx, it: arr[idx]};
      }
      return null;
    }

    function cardHtml(it, id, featured=false){
      const t = L();
      const name = itemName(it);
      const unit = fmt(calcItemUnitPrice(it, cart.get(id)?.selections));
      const qty = cartQty(id);
      const hasOpts = Array.isArray(normalizeOptions(it)) && normalizeOptions(it).length;
      const btn = qty
        ? `<div class="qty" data-qty="${id}">
             <button data-dec="${id}">âˆ’</button>
             <span>${qty}</span>
             <button data-inc="${id}">+</button>
           </div>`
        : `<button class="add" data-add="${id}">${t.ui.add}</button>`;
      const key = (it && (it.key || it.id || it.code)) || '';
      const shortDesc = getShortForItem(it) || '';
      const metaHtml = buildMeta(it);
      return `
        <div class="card ${featured?'featured':''} ${hasOpts?'has-opts':''}" data-id="${id}"${key ? ` data-key="${key}"` : ''}>
          <div class="thumb-wrap">
            <div class="thumb">
              <img alt="${escapeHtml(name)}" loading="lazy" decoding="async">
            </div>
            <button class="info"
                    data-toggle="${id}"
                    title="â„¹"
                    aria-label="Info"
                    aria-expanded="false">â„¹</button>
          </div>
          <div class="name">${escapeHtml(name)}</div>
          ${metaHtml}
          <p class="desc">${escapeHtml(shortDesc)}</p>
          <div class="foot">
            <div class="price">${unit}</div>
            ${btn}
          </div>
        </div>`;
    }

    function renderSection(content, title, items){
      const sec = document.createElement('section');
      sec.className = 'menu-section';
      sec.id = title.startsWith('TOP') ? 'sec-top' : '';
      const h2 = document.createElement('h2');
      h2.textContent = title;
      sec.appendChild(h2);
      const list = document.createElement('div');
      list.className = 'list';
      list.innerHTML = items.join('');
      sec.appendChild(list);
      content.appendChild(sec);
      // images
      list.querySelectorAll('.card').forEach(row => {
        const id = row.getAttribute('data-id');
        const [cat, idx] = id.split(':');
        const key = (MENU?.[cat]?.[+idx]?.key) || '';
        const img = row.querySelector('.thumb img');
        if (img && key) buildThumb(img, key);
      });
    }

    function renderMenu(){
      const content = $('#content');
      if (!content) return;
      content.innerHTML = '';
      const q = (document.getElementById('searchIn')?.value || '').trim().toLowerCase();
      localStorage.setItem(SEARCH_KEY, q);

      // Search results mode
      if (q){
        const res = [];
        for (const [cat, arr] of Object.entries(MENU || {})){
          (arr||[]).forEach((it, idx)=>{
            const name = itemName(it).toLowerCase();
            const short = getShortForItem(it).toLowerCase();
            const longDesc = pickLang(DESCS?.[it.key]?.description).toLowerCase();
            if (name.includes(q) || short.includes(q) || (longDesc && longDesc.includes(q))){
              const id = `${cat}:${idx}`;
              res.push(cardHtml(it, id, false));
            }
          });
        }
        renderSection(content, `ğŸ” ${q}`, res.length ? res : [`<div class="muted" style="padding:12px">ĞĞ¸Ñ‡ĞµĞ³Ğ¾ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾.</div>`]);
        applyView();
        return;
      }

      // TOP section
      const topCards = [];
      TOP_KEYS.forEach((k, i)=>{
        const f = findByKey(k);
        if (!f) return;
        const id = `${f.cat}:${f.idx}`;
        topCards.push(cardHtml(f.it, id, i===0));
      });
      if (topCards.length){
        renderSection(content, 'ğŸ”¥ TOP', topCards);
      }

      // Normal categories
      const keys = Object.keys(MENU || {});
      keys.forEach(k => {
        const items = (MENU[k] || []).map((it, idx) => {
          const id = `${k}:${idx}`;
          return cardHtml(it, id, idx===0);
        });
        renderSection(content, catLabel(k), items);
        const last = content.lastElementChild;
        if (last) last.id = `sec-${k}`;
      });

      applyView();
    }

    /* Cart counters + dock badges */
    function renderFab(){
      let items = 0, sum = 0;
      for (const [id, entry] of cart){
        const qty = entry?.qty || 0;
        const [cat, idx] = id.split(':');
        const it = MENU[cat]?.[+idx];
        if (!it || qty<=0) continue;
        items += qty;
        sum += calcItemUnitPrice(it, entry.selections) * qty;
      }
      const badge = $('#cartBadge');
      document.body.classList.toggle('cart-has-items', items > 0);
      if (badge){
        badge.textContent = items;
        badge.style.display = items > 0 ? 'flex' : 'none';
      }
      const meta = $('#cartMeta');
      if (meta){
        const s = L().sheet;
        meta.textContent = `${s.total}: ${fmt(sum)}`;
      }
    }

    /* Cart sheet render */
    function renderCartSheet(){
      const t = L().sheet;
      const lines = $('#cartLines');
      if (!lines) return;
      if (cart.size === 0){
        lines.innerHTML = `<div class="muted">${t.empty}</div>`;
        $('#cartMeta').textContent = `${t.total}: ${fmt(0)}`;
        return;
      }
      let sum = 0;
      lines.innerHTML = '';
      for (const [id, entry] of cart){
        const qty = entry?.qty || 0;
        if (qty<=0) continue;
        const [cat, idx] = id.split(':');
        const it = MENU[cat]?.[+idx];
        if (!it) continue;
        const name = itemName(it);
        const unit = calcItemUnitPrice(it, entry.selections);
        sum += unit * qty;
        const optText = summarizeSelections(it, entry.selections);
        const noteText = (entry.note || '').trim();
        const el = document.createElement('div');
        el.className = 'line';
        el.innerHTML = `
          <div>
            <strong>${name}</strong>
            ${optText ? `<div class="muted">${optText}</div>` : ``}
            ${noteText ? `<div class="muted">âœ ${escapeHtml(noteText)}</div>` : ``}
            <div class="muted">${fmt(unit)} Ã— ${qty}</div>
          </div>
          <div class="qty" data-qty="${id}">
            <button data-dec="${id}">âˆ’</button>
            <span>${qty}</span>
            <button data-inc="${id}">+</button>
          </div>`;
        lines.appendChild(el);
      }
      $('#cartMeta').textContent = `${t.total}: ${fmt(sum)}`;
    }

    /* Sheet open/close */
    function openSheet(){
      document.body.style.overflow = 'hidden';
      document.body.classList.add('sheet-open');
      $('#overlay').classList.add('show');
      $('#sheet').classList.add('open');
      renderCartSheet();
    }
    function closeSheet(){
      document.body.style.overflow = '';
      document.body.classList.remove('sheet-open');
      const overlay = document.getElementById('overlay');
      const sheet = document.getElementById('sheet');
      if (overlay){
        overlay.classList.remove('show');
        overlay.style.opacity = '';
        overlay.style.transition = '';
      }
      if (sheet){
        sheet.classList.remove('open');
        sheet.style.transform = '';
        sheet.style.transition = '';
      }
    }
    function openCatSheet(){
      document.body.classList.add('sheet-open');
      $('#catOverlay').classList.add('show');
      $('#catSheet').classList.add('open');
    }
    function closeCatSheet(){
      document.body.classList.remove('sheet-open');
      const overlay = document.getElementById('catOverlay');
      const sheet = document.getElementById('catSheet');
      if (overlay){
        overlay.classList.remove('show');
        overlay.style.opacity = '';
        overlay.style.transition = '';
      }
      if (sheet){
        sheet.classList.remove('open');
        sheet.style.transform = '';
        sheet.style.transition = '';
      }
    }

    /* Dish sheet open/close + rendering */
    const dishOverlay = $('#dishOverlay');
    const dishSheet = $('#dishSheet');
    const dishClose = $('#dishClose');
    const dishTitle = $('#dishTitle');
    const dishSub = $('#dishSub');
    const dishPriceEl = $('#dishPrice');
    const dishMedia = $('#dishMedia');
    const dishDesc = $('#dishDesc');
    const dishOptions = $('#dishOptions');
    const dishNote = $('#dishNote');
    const dishMinus = $('#dishMinus');
    const dishPlus = $('#dishPlus');
    const dishQtyEl = $('#dishQty');
    const dishAddBtn = $('#dishAddBtn');

    let dishCtx = null; // {id, cat, idx, it, tempSel, tempNote}

    function openDishSheet(){
      document.body.classList.add('sheet-open');
      dishOverlay?.classList.add('show');
      dishSheet?.classList.add('open');
    }
    function closeDishSheet(){
      document.body.classList.remove('sheet-open');
      dishOverlay?.classList.remove('show');
      dishSheet?.classList.remove('open');
      dishCtx = null;
    }

    function groupTitle(g){ return pickLang(g?.title); }
    function groupTitleSmart(g, it){
      const gid = g?.id || g?.key || g?.name || '';
      return vnPrettyTuyChon(groupTitle(g), it, gid);
    }
    function optionLabel(o){
      return pickLang(o?.label) || pickLang(o?.name) || o?.id || '';
    }

    function validateSelections(it, selections){
      // no required enforcement; only max limits
      const opts = normalizeOptions(it);
      for (const g of opts){
        const gid = g.id || g.key || g.name || '';
        const picked = selections?.[gid];
        if (g.max && Array.isArray(picked) && picked.length > Number(g.max)){
          return {ok:false, groupId: gid, title: groupTitle(g) || gid};
        }
      }
      return {ok:true};
    }

    function renderDishOptions(it, selections){
      const opts = normalizeOptions(it);
      if (!dishOptions) return;
      if (!opts.length){
        dishOptions.innerHTML = '';
        return;
      }
      dishOptions.innerHTML = opts.map(g=>{
        const gid = g.id || g.key || g.name || '';
        const multi = !!g.multi || (Number(g.max || 0) > 1);
        const max = Number(g.max || (multi ? 99 : 1));
        const showMax = (max && max < 99 && max !== 1);
        const required = (!!g.required) && (Number(g.max || (multi ? 99 : 1)) !== 1);
        const picked = selections?.[gid] || (multi ? [] : '');
        const pickedArr = Array.isArray(picked) ? picked : [picked].filter(Boolean);
        const itemsHtml = (g.items||[]).map(opt=>{
          const oid = opt.id || opt.key;
          const checked = pickedArr.includes(oid);
          const delta = Number(opt.price_delta || 0);
          const deltaHtml = delta ? `<span class="delta">${delta>0?`+${delta}`:delta} ${CURRENCY}</span>` : '';
          return `
            <label class="opt">
              <input type="${multi?'checkbox':'radio'}"
                     name="opt-${gid}"
                     value="${escapeHtml(oid)}"
                     ${checked?'checked':''}
                     data-gid="${escapeHtml(gid)}"
                     data-multi="${multi?'1':'0'}"
                     data-max="${max}">
              <span class="opt-name">${escapeHtml(optionLabel(opt))}</span>
              ${deltaHtml}
            </label>
          `;
        }).join('');
        return `
          <div class="opt-group" data-group="${escapeHtml(gid)}">
            <div class="opt-head">
              <div class="opt-title">${escapeHtml(groupTitleSmart(g, it) || '')}</div>
              <div class="muted opt-hint">${required ? L().common.required : L().common.optional}${showMax ? ` Â· max ${max}`:''}</div>
            </div>
            <div class="opt-list">${itemsHtml}</div>
          </div>
        `;
      }).join('');
    }

    async function renderDishSheet(ctx){
      const {id, it} = ctx;
      dishTitle.textContent = itemName(it);
      dishSub.textContent = buildMeta(it).replace(/<[^>]*>/g,'') || '';
      dishQtyEl.textContent = String(cartQty(id));

      // image
      dishMedia.innerHTML = '';
      const key = it.key || '';
      if (key){
        const wrap = document.createElement('div');
        wrap.className = 'dish-thumb';
        wrap.innerHTML = `<img alt="${escapeHtml(itemName(it))}" loading="lazy" decoding="async">`;
        const img = wrap.querySelector('img');
        dishMedia.appendChild(wrap);
        if (img) buildThumb(img, key);
      }

      // desc lazy
      dishDesc.textContent = getShortForItem(it) || '';
      try{
        const descs = await loadDescriptions();
        const entry = key ? descs[key] : null;
        const text = pickLang(entry?.description || entry?.short);
        if (text) dishDesc.textContent = text;
      }catch(e){}

      // options
      renderDishOptions(it, ctx.tempSel);

      // note
      dishNote.value = ctx.tempNote || '';

      updateDishPrice();
    }

    function updateDishPrice(){
      if (!dishCtx) return;
      const it = dishCtx.it;
      const unit = calcItemUnitPrice(it, dishCtx.tempSel);
      dishPriceEl.textContent = fmt(unit);
    }

    function openDishById(cardId){
      const [cat, idxStr] = (cardId||'').split(':');
      const idx = Number(idxStr);
      const it = MENU?.[cat]?.[idx];
      if (!it) return;
      const entry = cart.get(cardId) || {qty:0, selections:{}, note:''};
      dishCtx = {
        id: cardId,
        cat, idx,
        it,
        tempSel: JSON.parse(JSON.stringify(entry.selections||{})),
        tempNote: entry.note || ''
      };
      openDishSheet();
      renderDishSheet(dishCtx);
    }

    dishOverlay?.addEventListener('click', closeDishSheet);
    dishClose?.addEventListener('click', (e)=>{ e.stopPropagation(); closeDishSheet(); });

    dishOptions?.addEventListener('change', (e)=>{
      if (!dishCtx) return;
      const inp = e.target.closest('input[data-gid]');
      if (!inp) return;
      const gid = inp.dataset.gid;
      const multi = inp.dataset.multi === '1';
      const max = Number(inp.dataset.max || 99);

      if (multi){
        const arr = Array.isArray(dishCtx.tempSel[gid]) ? dishCtx.tempSel[gid] : [];
        if (inp.checked){
          if (arr.length >= max){
            inp.checked = false;
            return;
          }
          arr.push(inp.value);
        } else {
          const i = arr.indexOf(inp.value);
          if (i>=0) arr.splice(i,1);
        }
        dishCtx.tempSel[gid] = arr;
      } else {
        dishCtx.tempSel[gid] = inp.value;
      }
      updateDishPrice();
    });

    dishNote?.addEventListener('input', ()=>{
      if (!dishCtx) return;
      dishCtx.tempNote = dishNote.value;
    });

    dishMinus?.addEventListener('click', ()=>{
      if (!dishCtx) return;
      cartInc(dishCtx.id, -1);
      dishQtyEl.textContent = String(cartQty(dishCtx.id));
      renderMenu(); renderCartSheet(); renderFab();
    });

    dishPlus?.addEventListener('click', ()=>{
      if (!dishCtx) return;
      const current = cart.get(dishCtx.id);
      if (!current || current.qty<=0){
        cartSetEntry(dishCtx.id, {qty:1, selections:dishCtx.tempSel||{}, note:(dishCtx.tempNote||'')});
      } else {
        cartInc(dishCtx.id, +1);
      }
      dishQtyEl.textContent = String(cartQty(dishCtx.id));
      renderMenu(); renderCartSheet(); renderFab();
    });

    dishAddBtn?.addEventListener('click', ()=>{
      if (!dishCtx) return;
      const v = validateSelections(dishCtx.it, dishCtx.tempSel);
      if (!v.ok){
        alert(`Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ: ${v.title}`);
        const gEl = dishOptions?.querySelector(`.opt-group[data-group="${CSS.escape(v.groupId)}"]`);
        gEl?.scrollIntoView({behavior:'smooth', block:'center'});
        return;
      }
      const q = cartQty(dishCtx.id);
      if (q<=0){
        cartSetEntry(dishCtx.id, {qty:1, selections:dishCtx.tempSel||{}, note:(dishCtx.tempNote||'')});
      } else {
        const entry = cart.get(dishCtx.id) || {qty:q, selections:{}, note:''};
        entry.selections = dishCtx.tempSel||{};
        entry.note = dishCtx.tempNote||'';
        cartSetEntry(dishCtx.id, entry);
      }
      dishQtyEl.textContent = String(cartQty(dishCtx.id));
      renderMenu(); renderCartSheet(); renderFab();
      closeDishSheet();
      openSheet();
    });

    /* Global click handlers */
    document.addEventListener('click', async e=>{
      const add = e.target.closest('[data-add]');
      if (add){
        const id = add.dataset.add;
        const [cat, idx] = id.split(':');
        const it = MENU?.[cat]?.[+idx];
        if (it && (Array.isArray(normalizeOptions(it)) && normalizeOptions(it).length)){
          openDishById(id);
          return;
        }
        cartInc(id, +1);
        renderMenu(); renderFab();
        return;
      }
      const inc = e.target.closest('[data-inc]');
      if (inc){
        const id = inc.dataset.inc;
        cartInc(id, +1);
        renderMenu(); renderCartSheet(); renderFab();
        return;
      }
      const dec = e.target.closest('[data-dec]');
      if (dec){
        const id = dec.dataset.dec;
        cartInc(id, -1);
        renderMenu(); renderCartSheet(); renderFab();
        return;
      }
      const info = e.target.closest('[data-toggle]');
      if (info){
        e.preventDefault();
        const cardId = info.dataset.toggle;
        openDishById(cardId);
        return;
      }
      const cardTap = e.target.closest('.card[data-id]');
      if (cardTap && !e.target.closest('.add') && !e.target.closest('.qty') && !e.target.closest('.info')){
        const cid = cardTap.getAttribute('data-id');
        openDishById(cid);
        return;
      }
      if (e.target.id === 'overlay'){ closeSheet(); return; }
      if (e.target.id === 'clearBtn'){
        cart.clear(); saveCart();
        renderMenu(); renderCartSheet(); renderFab();
        return;
      }
    });

    /* Burger menu */
    const burgerBtn = $('#burgerBtn');
    const navPop = $('#navPop');
    burgerBtn.addEventListener('click', ()=>{
      const open = navPop.classList.toggle('open');
      burgerBtn.setAttribute('aria-expanded', String(open));
    });
    document.addEventListener('click', e=>{
      const navPop = document.getElementById('navPop');
      const burgerBtn= document.getElementById('burgerBtn');
      const dockMore = document.getElementById('dockMore');
      if (!navPop) return;
      if (!navPop.contains(e.target) && e.target !== burgerBtn && e.target !== dockMore) {
        navPop.classList.remove('open');
        burgerBtn?.setAttribute('aria-expanded','false');
      }
    });

    /* Order type switch */
    const otWrap = $('#orderType');
    const tableField = $('#tableField');
    const takeawayField = $('#takeawayField');
    const addrField = $('#addrField');
    const tableNo = $('#tableNo');
    const pickupIn = $('#pickupIn');
    const address = $('#address');
    const phone = $('#phone');
    const phoneHint = $('#phoneHint');
    const tableHint = $('#tableHint');
    const pickupHint = $('#pickupHint');
    const addrHint = $('#addrHint');
    function show(el,on){ if(el) el.style.display = on?'grid':'none'; }
    function setOrderType(v){
      const c = L();
      show(tableField, v === 'on_site');
      show(takeawayField, v === 'takeaway');
      show(addrField, v === 'delivery');
      if (tableNo) tableNo.required = (v === 'on_site');
      if (pickupIn) pickupIn.required = (v === 'takeaway');
      if (address) address.required = (v === 'delivery');
      phoneHint.textContent = (v === 'on_site') ? c.common.optional : c.common.required;
      tableHint.textContent = c.common.required;
      pickupHint.textContent = c.common.required;
      addrHint.textContent = c.common.required;
    }
    otWrap.addEventListener('click', e=>{
      const b = e.target.closest('[data-ot]');
      if (!b) return;
      $$('#orderType .chip').forEach(x => x.classList.remove('active'));
      b.classList.add('active');
      setOrderType(b.dataset.ot);
    });

    /* Dock labels */
    function applyDockLabels(){
      const t = L();
      const tb = t.tabbar || {};
      const sheetT = t.sheet;
      const dm = $('#dockCat');
      const dl = $('#dockLang');
      const dc = $('#dockCart');
      const dv = $('#dockView');
      const dr = $('#dockMore');
      if (dm) dm.dataset.label = tb.menu || t.navMenu || 'Menu';
      if (dl) dl.dataset.label = tb.lang || 'Lang';
      if (dc) dc.dataset.label = tb.cart || (sheetT && sheetT.title) || 'Cart';
      if (dv) dv.dataset.label = (viewMode === 'grid' ? t.ui.viewGrid : t.ui.viewList);
      if (dr) dr.dataset.label = tb.more || 'More';
    }

    /* I18N apply */
    const selA = $('#langSel');
    const selB = $('#langSelMenu');
    function setUITexts(){
      const t = L();
      const s = t.sheet;
      $('#navHome').textContent = 'ğŸ  ' + t.navHome;
      $('#navMenu').textContent = 'ğŸœ ' + t.navMenu;
      $('#navKaraoke').textContent = 'ğŸ¤ ' + t.navKaraoke;
      $('#navContact').textContent = 'ğŸ“ ' + t.navContact;
      $('#sheetTitle').textContent = s.title;
      $('#orderTypeTitle').textContent = s.orderType;
      $('#otOnSite').textContent = s.onSite;
      $('#otTakeaway').textContent = s.takeaway;
      $('#otDelivery').textContent = s.delivery;
      $('#tableLbl').childNodes[0].nodeValue = s.table + ' ';
      $('#pickupLbl').childNodes[0].nodeValue = s.pickupIn + ' ';
      $('#addrLbl').childNodes[0].nodeValue = s.address + ' ';
      $('#phoneLbl').childNodes[0].nodeValue = s.phone + ' ';
      tableNo.placeholder = s.phTable;
      pickupIn.placeholder = s.phPickup;
      address.placeholder = s.phAddress;
      phone.placeholder = s.phPhone;
      $('#checkoutBtn').textContent = s.checkout;
      $('#clearBtn').textContent = s.clear;
      const csTitle = $('#catSheetTitle');
      if (csTitle) csTitle.textContent = t.navMenu || 'ĞšĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸';
      renderPills();
      renderMenu();
      renderFab();
      renderCartSheet();
      const active = document.querySelector('#orderType .chip.active')?.dataset.ot || 'on_site';
      setOrderType(active);
      applyDockLabels();
    }

    /* Search + order status UI */
    const searchInEl = $('#searchIn');
    const searchClearEl = $('#searchClear');
    const statusCodeEl = $('#statusCode');
    const statusBtnEl = $('#statusBtn');
    const statusResultEl = $('#statusResult');
    const debouncedRenderMenu = (()=>{ let t; return ()=>{ clearTimeout(t); t=setTimeout(()=>{ renderMenu(); renderFab(); }, 120); }; })();

    function renderStatus(code){
      const orders = loadOrders();
      const rec = orders[(code||'').trim().toLowerCase()];
      if (!statusResultEl) return;
      if (!code){
        statusResultEl.innerHTML = '';
        return;
      }
      if (!rec){
        statusResultEl.innerHTML = `<div class="muted">Ğ—Ğ°ĞºĞ°Ğ· <b>${escapeHtml(code)}</b> Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ Ğ½Ğ° ÑÑ‚Ğ¾Ğ¼ ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğµ.</div>`;
        return;
      }
      const when = new Date(rec.created_at).toLocaleString();
      const total = Number(rec.total||0).toFixed(2);
      statusResultEl.innerHTML = `
        <div class="status-card">
          <div><b>ĞšĞ¾Ğ´:</b> ${escapeHtml(rec.code)} <span class="pill-mini">${escapeHtml(rec.status||'â€”')}</span></div>
          <div class="muted">ID: ${escapeHtml(rec.id)} Â· ${escapeHtml(when)}</div>
          <div class="muted">Ğ˜Ñ‚Ğ¾Ğ³Ğ¾: ${total} ${escapeHtml(rec.currency||CURRENCY)}</div>
        </div>
      `;
    }

    searchInEl?.addEventListener('input', debouncedRenderMenu);
    searchClearEl?.addEventListener('click', ()=>{
      if (!searchInEl) return;
      searchInEl.value = '';
      debouncedRenderMenu();
      searchInEl.focus();
    });
    statusBtnEl?.addEventListener('click', ()=>{
      const code = statusCodeEl?.value || '';
      renderStatus(code);
    });
    statusCodeEl?.addEventListener('keydown', (e)=>{
      if (e.key === 'Enter'){
        e.preventDefault();
        renderStatus(statusCodeEl.value);
      }
    });

    function setLang(v){
      LANG = v;
      localStorage.setItem(LANG_KEY, v);
      document.documentElement.lang = v;
      if (selA) selA.value = v;
      if (selB) selB.value = v;
      const flag = LANG_FLAGS[v] || 'ğŸŒ';
      const langFlagEl = $('#dockLangFlag');
      if (langFlagEl) langFlagEl.textContent = flag;
      const savedQ = localStorage.getItem(SEARCH_KEY) || '';
      const searchIn = document.getElementById('searchIn');
      if (searchIn) searchIn.value = savedQ;
      setUITexts();
      loadDescriptions()
        .then(() => {
          renderMenu();
          renderFab();
          if (dishCtx) renderDishSheet(dishCtx);
        })
        .catch(() => {});
      document.dispatchEvent(new CustomEvent('CD_LANG_CHANGED'));
    }
    selA?.addEventListener('change', e => setLang(e.target.value));
    selB?.addEventListener('change', e => setLang(e.target.value));

    /* Telegram via proxy */
    /* SECURITY NOTE: keep token out of frontend in production. Use PROXY_URL and store token server-side. */
    const TG = {
      BOT_TOKEN: "PUT_YOUR_BOT_TOKEN_HERE", // <-- Ğ²Ñ‹Ğ½ĞµÑĞ¸ Ñ‚Ğ¾ĞºĞµĞ½ Ğ½Ğ° ÑĞµÑ€Ğ²ĞµÑ€ (proxy) ĞµÑĞ»Ğ¸ ÑÑ‚Ğ¾ Ğ¿ÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ ÑĞ°Ğ¹Ñ‚
      CHAT_ID: "-1002283682762", // <-- Ñ‚Ğ²Ğ¾Ğ¹ chat id
      PROXY_URL: "" // "/api/tg/sendMessage" ĞµÑĞ»Ğ¸ Ğ±ÑƒĞ´ĞµÑ‚ ÑĞµÑ€Ğ²ĞµÑ€
    };

    function TG_ENDPOINT() {
      if (TG.PROXY_URL && TG.PROXY_URL.trim()) return TG.PROXY_URL;
      if (!TG.BOT_TOKEN) throw new Error("TG.BOT_TOKEN is empty");
      return `https://api.telegram.org/bot${TG.BOT_TOKEN}/sendMessage`;
    }

    async function sendOrderToTelegram(text) {
      const url = TG_ENDPOINT();
      const payload = {
        chat_id: TG.CHAT_ID,
        text,
        parse_mode: "HTML",
        disable_web_page_preview: true
      };
      const r = await fetch(url, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });
      let data = null;
      try { data = await r.json(); } catch (_) {}
      if (!r.ok) {
        const msg = (data && (data.description || data.error)) || `HTTP ${r.status}`;
        return { ok: false, reason: msg };
      }
      if (data && data.ok === false) {
        return { ok: false, reason: data.description || "Telegram error" };
      }
      return { ok: true, data };
    }

    async function createOrderOnSheet(orderPayload){
      const body = { action:'create', ...orderPayload };
      try{
        const res = await fetch(API_BASE,{ method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(body) });
        const data = await res.json();
        return data;
      }catch(e){
        console.error('Sheets error', e);
        return {ok:false, error:String(e)};
      }
    }

    function cartSummary(){
      let itemsCount = 0, sum = 0;
      const lines = [];
      const items = [];
      for (const [id, entry] of cart){
        const qty = entry?.qty || 0;
        if (qty<=0) continue;
        const [cat, idx] = id.split(':');
        const it = MENU[cat]?.[+idx];
        if (!it) continue;
        const name = itemName(it);
        const unit = calcItemUnitPrice(it, entry.selections);
        const key = it.key || it.id || it.code || '';
        const optText = summarizeSelections(it, entry.selections);
        const noteText = (entry.note || '').trim();
        itemsCount += qty;
        sum += unit * qty;
        const extra = [optText ? `(${optText})` : '', noteText ? `[${noteText}]` : ''].filter(Boolean).join(' ');
        const isCustom = (Array.isArray(it.tags) && it.tags.includes('custom')) || String(it.key||'').startsWith('custom_');
        if (isCustom){
          const optLines = summarizeSelectionsLines(it, entry.selections);
          lines.push(`â€¢ ${name} â€” ${unit.toFixed(2)} ${CURRENCY} Ã— ${qty}`);
          for (const l of optLines){ lines.push(` â”” ${l}`); }
          if (noteText) lines.push(` â”” Note: ${noteText}`);
        } else {
          lines.push(`â€¢ ${name} ${extra} â€” ${unit.toFixed(2)} ${CURRENCY} Ã— ${qty}`);
        }
        items.push({ name, price: unit, qty, key, selections: entry.selections || {}, note: noteText });
      }
      return {itemsCount,sum,lines,items};
    }

    function generateShortCode(){
      const letters = 'abcdefghijklmnopqrstuvwxyz';
      const letter = letters[Math.floor(Math.random() * letters.length)];
      const num = Math.floor(Math.random() * 999) + 1;
      return letter + String(num).padStart(3,'0');
    }

    $('#checkoutBtn').addEventListener('click', async ()=>{
      const s = L().sheet;
      const ot = document.querySelector('#orderType .chip.active')?.dataset.ot || 'on_site';
      if (ot === 'on_site' && !tableNo.value.trim()){ alert(s.errTable); return; }
      if (ot === 'takeaway'){
        if (!pickupIn.value.trim()){ alert(s.errPickup); return; }
        if (!phone.value.trim()){ alert(s.errPhone); return; }
      }
      if (ot === 'delivery'){
        if (!address.value.trim()){ alert(s.errAddress); return; }
        if (!phone.value.trim()){ alert(s.errPhone); return; }
      }

      const {sum,lines,items} = cartSummary();
      const typeStr = ot === 'on_site' ? s.onSite : ot === 'takeaway' ? s.takeaway : s.delivery;
      const meta = [];
      if (ot === 'on_site') meta.push(`${s.table}: ${tableNo.value.trim()}`);
      if (ot === 'takeaway') meta.push(`${s.pickupIn}: ${pickupIn.value.trim()}`);
      if (ot === 'delivery') meta.push(`${s.address}: ${address.value.trim()}`);
      if (phone.value.trim()) meta.push(`${s.phone}: ${phone.value.trim()}`);

      const ordId = 'CD-'+new Date().toISOString().replace(/[-:TZ.]/g,'').slice(0,14);
      const orderCode = generateShortCode();

      const text =
`<b>DLV90s â€” New order</b>
ID: <code>${ordId}</code>
Code: <b>${orderCode}</b>
${s.total}: <b>${sum.toFixed(2)} ${CURRENCY}</b>
Type: <b>${typeStr}</b>
${meta.join('\n')}
<b>Items:</b>
${lines.join('\n') || 'â€”'}`;

      const orderPayload = {
        id: ordId,
        code: orderCode,
        status: 'NEW',
        type: ot,
        table: ot==='on_site' ? tableNo.value.trim() : '',
        pickup_in: ot==='takeaway' ? pickupIn.value.trim() : '',
        address: ot==='delivery' ? address.value.trim() : '',
        phone: phone.value.trim(),
        items,
        total: sum,
        created_at: new Date().toISOString()
      };

      const [tgRes, sheetRes] = await Promise.all([
        sendOrderToTelegram(text),
        createOrderOnSheet(orderPayload)
      ]);

      const orders = loadOrders();
      orders[orderCode] = {
        code: orderCode,
        id: ordId,
        created_at: orderPayload.created_at,
        total: sum,
        currency: CURRENCY,
        type: ot,
        meta,
        items,
        tg: tgRes,
        sheet: sheetRes,
        status: (tgRes?.ok ? (tgRes?.opaque ? 'SENT (unconfirmed)' : 'SENT') : 'FAILED')
      };
      saveOrders(orders);

      let icon;
      if ((tgRes?.ok) && (sheetRes?.ok || sheetRes?.id)) icon = 'âœ”âœ”';
      else if (tgRes?.ok || sheetRes?.ok || sheetRes?.id) icon = 'âœ”â€¦';
      else icon = 'â€¦';

      alert(`${icon} ID: ${ordId} â€¢ ${s.total}: ${sum.toFixed(2)} ${CURRENCY}`);
      cart.clear(); saveCart();
      renderMenu();
      renderCartSheet();
      renderFab();
      closeSheet();
    });

    /* Scroll highlight for pills */
    let activeCat = '';
    const debounce = (fn,delay) => { let timer; return () => { clearTimeout(timer); timer = setTimeout(fn,delay); }; };
    function updateActive(){
      const header = $('.header');
      const catNav = $('.cat-nav');
      if (!header || !catNav) return;
      const stickyH = header.offsetHeight + catNav.offsetHeight;
      let maxTop = -Infinity;
      let closest = null;
      $$('section').forEach(sec => {
        if (!sec.id || !sec.id.startsWith('sec-')) return;
        const top = sec.getBoundingClientRect().top;
        if (top <= stickyH && top > maxTop){
          maxTop = top;
          closest = sec;
        }
      });
      if (closest){
        const cat = closest.id.replace('sec-','');
        if (cat !== activeCat){
          activeCat = cat;
          $$('.pill').forEach(p => p.classList.remove('active'));
          const pill = $(`.pill[href="#${closest.id}"]`);
          if (pill){
            pill.classList.add('active');
            pill.scrollIntoView({behavior:'smooth',inline:'center'});
          }
        }
      }
    }
    window.addEventListener('scroll', debounce(updateActive,50));

    /* Dynamic Island + move pills into bar */
    const catPillsEl = $('#catPills');
    const catPillsParent = catPillsEl?.parentNode || null;
    const catPillsSibling = catPillsEl?.nextSibling || null;
    function islandThreshold(){ return 80; }
    let islandActive = false;
    const onScrollIsland = (() => {
      let ticking = false;
      return () => {
        if (ticking) return;
        ticking = true;
        requestAnimationFrame(() => {
          const needIsland = window.scrollY > islandThreshold();
          if (needIsland !== islandActive){
            islandActive = needIsland;
            document.body.classList.toggle('island', islandActive);
            const bar = $('.bar');
            const catPills = $('#catPills');
            if (islandActive){
              if (bar && catPills) bar.appendChild(catPills);
            } else {
              if (catPillsParent && catPills){
                if (catPillsSibling) catPillsParent.insertBefore(catPills,catPillsSibling);
                else catPillsParent.appendChild(catPills);
              }
            }
          }
          ticking = false;
        });
      };
    })();
    window.addEventListener('scroll', onScrollIsland, {passive:true});
    window.addEventListener('resize', onScrollIsland);
    onScrollIsland();

    /* ===== Bottom Dock logic ===== */
    const dockCat = $('#dockCat');
    const dockView = $('#dockView');
    const dockMore = $('#dockMore');
    const dockLang = $('#dockLang');
    const dockCart = $('#dockCart');
    const langPopup = $('#langPopup');
    const catOverlayEl = $('#catOverlay');
    const catSheetEl = $('#catSheet');
    const catSheetList = $('#catSheetList');

    function buildCatSheet(){
      if (!catSheetList) return;
      const keys = Object.keys(MENU || {});
      catSheetList.innerHTML = keys.map(k =>
        `<button class="chip" data-goto="#sec-${k}">${catLabel(k)}</button>`
      ).join('');
    }
    catOverlayEl?.addEventListener('click', closeCatSheet);
    catSheetEl?.addEventListener('click', e=>{
      const b = e.target.closest('[data-goto]');
      if (!b) return;
      const target = b.getAttribute('data-goto');
      closeCatSheet();
      document.querySelector(target)?.scrollIntoView({behavior:'smooth',block:'start'});
    });

    function setActiveDock(btn){
      $$('.dock-btn').forEach(b=>{
        if (b === btn) b.classList.add('active');
        else b.classList.remove('active');
      });
    }

    dockCat?.addEventListener('click', ()=>{
      setActiveDock(dockCat);
      buildCatSheet();
      openCatSheet();
    });

    dockView?.addEventListener('click', ()=>{
      setActiveDock(dockView);
      viewMode = (viewMode === 'grid') ? 'list' : 'grid';
      localStorage.setItem(VIEW_KEY, viewMode);
      applyView();
      applyDockLabels();
    });

    dockLang?.addEventListener('click', (e)=>{
      e.stopPropagation();
      setActiveDock(dockLang);
      if (!langPopup) return;
      langPopup.classList.toggle('show');
    });

    langPopup?.addEventListener('click', e=>{
      const b = e.target.closest('[data-lang]');
      if (!b) return;
      const code = b.dataset.lang;
      setLang(code);
      langPopup.classList.remove('show');
    });

    document.addEventListener('click', e=>{
      if (!langPopup) return;
      if (!langPopup.contains(e.target) && !dockLang.contains(e.target)){
        langPopup.classList.remove('show');
      }
    });

    dockMore?.addEventListener('click', (e)=>{
      e.stopPropagation();
      const navPop = document.getElementById('navPop');
      const burgerBtn = document.getElementById('burgerBtn');
      if (!navPop) return;
      const open = !navPop.classList.contains('open');
      navPop.classList.toggle('open', open);
      burgerBtn?.setAttribute('aria-expanded', String(open));
    });

    dockCart?.addEventListener('click', ()=>{
      setActiveDock(dockCart);
      openSheet();
    });

    const brandEl = $('#brandTap');
    brandEl?.addEventListener('click', (e)=>{
      if (!document.body.classList.contains('island')) return;
      e.preventDefault();
      window.scrollTo({top:0, behavior:'smooth'});
    });

    const sheetClose = $('#sheetClose');
    sheetClose?.addEventListener('click', (e)=>{ e.stopPropagation(); closeSheet(); });
    const catSheetClose = $('#catSheetClose');
    catSheetClose?.addEventListener('click', (e)=>{ e.stopPropagation(); closeCatSheet(); });

    document.addEventListener('keydown', e=>{
      if (e.key === 'Escape'){
        if ($('#sheet')?.classList.contains('open')) closeSheet();
        if ($('#catSheet')?.classList.contains('open')) closeCatSheet();
        if (langPopup?.classList.contains('show')) langPopup.classList.remove('show');
        if ($('#dishSheet')?.classList.contains('open')) closeDishSheet();
      }
    });

    // Swipe-down close sheets
    (function(){
      const cartSheet = $('#sheet');
      const cartOverlay = $('#overlay');
      const catSheet = $('#catSheet');
      const catOverlay = $('#catOverlay');
      const DRAG_START_ZONE = 40;
      const DISMISS_Y = 120;
      const MAX_DRAG = 280;
      function attachSwipe(sheetEl, overlayEl, closeFn){
        if (!sheetEl) return;
        let startY = 0;
        let currentY = 0;
        let dragging = false;
        function onStart(e){
          const touch = e.touches && e.touches[0];
          if (!touch) return;
          const rect = sheetEl.getBoundingClientRect();
          const offsetY = touch.clientY - rect.top;
          if (offsetY > DRAG_START_ZONE) return;
          dragging = true;
          startY = touch.clientY;
          currentY = 0;
          sheetEl.style.transition = 'transform .0s';
          if (overlayEl) overlayEl.style.transition = 'opacity .0s';
        }
        function onMove(e){
          if (!dragging) return;
          const touch = e.touches && e.touches[0];
          if (!touch) return;
          const dy = touch.clientY - startY;
          if (dy <= 0){
            currentY = 0;
            sheetEl.style.transform = 'translateY(0)';
            if (overlayEl) overlayEl.style.opacity = '1';
            return;
          }
          currentY = Math.min(dy, MAX_DRAG);
          const progress = currentY / MAX_DRAG;
          sheetEl.style.transform = `translateY(${currentY}px)`;
          if (overlayEl) overlayEl.style.opacity = String(1 - progress * 0.7);
        }
        function onEnd(){
          if (!dragging) return;
          dragging = false;
          sheetEl.style.transition = 'transform .22s ease';
          if (overlayEl) overlayEl.style.transition = 'opacity .22s ease';
          if (currentY > DISMISS_Y){
            sheetEl.style.transform = `translateY(${MAX_DRAG}px)`;
            if (overlayEl) overlayEl.style.opacity = '0';
            setTimeout(()=>{
              sheetEl.style.transform = '';
              if (overlayEl) overlayEl.style.opacity = '';
              closeFn();
            },200);
          } else {
            sheetEl.style.transform = 'translateY(0)';
            if (overlayEl) overlayEl.style.opacity = '1';
          }
        }
        sheetEl.addEventListener('touchstart', onStart, {passive:true});
        sheetEl.addEventListener('touchmove', onMove, {passive:true});
        sheetEl.addEventListener('touchend', onEnd);
        sheetEl.addEventListener('touchcancel',onEnd);
      }
      attachSwipe(cartSheet, cartOverlay, closeSheet);
      attachSwipe(catSheet, catOverlay, closeCatSheet);
    })();

    /* Init */
    (function init(){
      loadCart();

      // Inject "Pho constructor" as the first item in Pho Soups
      try{
        const arr = MENU?.pho_soups;
        if (Array.isArray(arr) && !arr.some(x => x && x.key === 'pho_custom')){
          arr.unshift({
            key:'pho_custom',
            price: 160,
            weight: 700,
            spicy: 0,
            tags:['chef','popular'],
            translations:{
              ru:'Pho â€” Ğ¡Ğ¾Ğ±ĞµÑ€Ğ¸ ÑĞ°Ğ¼',
              ua:'Pho â€” Ğ—Ğ±ĞµÑ€Ğ¸ ÑĞ°Ğ¼',
              en:'Pho â€” Build your own',
              vn:'Tá»± táº¡o tÃ´ Phá»Ÿ theo Ã½ báº¡n',
              pl:'Pho â€” ZÅ‚Ã³Å¼ sam',
              de:'Pho â€” Stelle selbst zusammen',
              zh:'æ²³ç²‰â€”è‡ªé€‰'
            },
            short:{
              ru:'Ğ‘ÑƒĞ»ÑŒĞ¾Ğ½ + Ğ»Ğ°Ğ¿ÑˆĞ°. Ğ’Ñ‹Ğ±Ğ¸Ñ€Ğ°ĞµÑˆÑŒ Ğ±ĞµĞ»Ğ¾Ğº Ğ¸ Ğ´Ğ¾Ğ±Ğ°Ğ²ĞºĞ¸. ĞœĞ¾Ğ¶Ğ½Ğ¾ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ: gÃ  / bÃ² / heo / tÃ´m.',
              ua:'Ğ‘ÑƒĞ»ÑŒĞ¹Ğ¾Ğ½ + Ğ»Ğ¾ĞºÑˆĞ¸Ğ½Ğ°. ĞĞ±Ğ¸Ñ€Ğ°Ñ”Ñˆ Ğ±Ñ–Ğ»Ğ¾Ğº Ñ– Ğ´Ğ¾Ğ´Ğ°Ñ‚ĞºĞ¸. ĞœĞ¾Ğ¶Ğ½Ğ° Ğ´Ğ¾Ğ´Ğ°Ñ‚Ğ¸: gÃ  / bÃ² / heo / tÃ´m.',
              en:'Broth + noodles. Choose protein + extras. Add: chicken / beef / pork / shrimp.',
              vn:'NÆ°á»›c dÃ¹ng + bÃ¡nh phá»Ÿ. Chá»n Ä‘áº¡m & topping. CÃ³ thá»ƒ thÃªm: gÃ  / bÃ² / heo / tÃ´m.',
              pl:'Bulion + makaron. Wybierz biaÅ‚ko i dodatki. MoÅ¼esz dodaÄ‡: kurczak / woÅ‚owina / wieprzowina / krewetki.',
              de:'BrÃ¼he + Nudeln. WÃ¤hle Protein und Extras. HinzufÃ¼gen: Huhn / Rind / Schwein / Garnelen.',
              zh:'æ¸…æ±¤+æ²³ç²‰ã€‚é€‰ä¸»æ–™å’ŒåŠ æ–™ã€‚å¯åŠ ï¼šé¸¡/ç‰›/çŒª/è™¾ã€‚'
            },
            options:[
              {id:'protein', title:{ru:'Ğ‘ĞµĞ»Ğ¾Ğº',en:'Protein',ua:'Ğ‘Ñ–Ğ»Ğ¾Ğº',vn:'Äáº¡m',pl:'BiaÅ‚ko',de:'Protein',zh:'ä¸»æ–™'}, required:true, multi:true, max:2,
                items:[
                  {id:'beef', label:{ru:'Ğ“Ğ¾Ğ²ÑĞ´Ğ¸Ğ½Ğ°',en:'Beef',ua:'Ğ¯Ğ»Ğ¾Ğ²Ğ¸Ñ‡Ğ¸Ğ½Ğ°',vn:'BÃ²',pl:'WoÅ‚owina',de:'Rind',zh:'ç‰›è‚‰'}, price_delta:40},
                  {id:'chicken', label:{ru:'ĞšÑƒÑ€Ğ¸Ñ†Ğ°',en:'Chicken',ua:'ĞšÑƒÑ€ĞºĞ°',vn:'GÃ ',pl:'Kurczak',de:'Huhn',zh:'é¸¡è‚‰'}, price_delta:30},
                  {id:'pork', label:{ru:'Ğ¡Ğ²Ğ¸Ğ½Ğ¸Ğ½Ğ°',en:'Pork',ua:'Ğ¡Ğ²Ğ¸Ğ½Ğ¸Ğ½Ğ°',vn:'Heo',pl:'Wieprzowina',de:'Schwein',zh:'çŒªè‚‰'}, price_delta:30},
                  {id:'shrimp', label:{ru:'ĞšÑ€ĞµĞ²ĞµÑ‚ĞºĞ¸',en:'Shrimp',ua:'ĞšÑ€ĞµĞ²ĞµÑ‚ĞºĞ¸',vn:'TÃ´m',pl:'Krewetki',de:'Garnelen',zh:'è™¾'}, price_delta:50},
                  {id:'tofu', label:{ru:'Ğ¢Ğ¾Ñ„Ñƒ',en:'Tofu',ua:'Ğ¢Ğ¾Ñ„Ñƒ',vn:'Äáº­u phá»¥',pl:'Tofu',de:'Tofu',zh:'è±†è…'}, price_delta:20},
                ]},
              {id:'extras', title:{ru:'Ğ”Ğ¾Ğ±Ğ°Ğ²ĞºĞ¸',en:'Extras',ua:'Ğ”Ğ¾Ğ´Ğ°Ñ‚ĞºĞ¸',vn:'ThÃªm',pl:'Dodatki',de:'Extras',zh:'åŠ æ–™'}, required:false, multi:true, max:5,
                items:[
                  {id:'corn', label:{ru:'ĞšÑƒĞºÑƒÑ€ÑƒĞ·Ğ°',en:'Corn',ua:'ĞšÑƒĞºÑƒÑ€ÑƒĞ´Ğ·Ğ°',vn:'Báº¯p',pl:'Kukurydza',de:'Mais',zh:'ç‰ç±³'}, price_delta:15},
                  {id:'scallion', label:{ru:'Ğ—ĞµĞ»Ñ‘Ğ½Ñ‹Ğ¹ Ğ»ÑƒĞº',en:'Scallion',ua:'Ğ—ĞµĞ»ĞµĞ½Ğ° Ñ†Ğ¸Ğ±ÑƒĞ»Ñ',vn:'HÃ nh lÃ¡',pl:'Szczypiorek',de:'FrÃ¼hlingszwiebel',zh:'è‘±'}, price_delta:10},
                  {id:'onion', label:{ru:'Ğ›ÑƒĞº',en:'Onion',ua:'Ğ¦Ğ¸Ğ±ÑƒĞ»Ñ',vn:'HÃ nh',pl:'Cebula',de:'Zwiebel',zh:'æ´‹è‘±'}, price_delta:8},
                  {id:'peanut', label:{ru:'ĞÑ€Ğ°Ñ…Ğ¸Ñ',en:'Peanut',ua:'ĞÑ€Ğ°Ñ…Ñ–Ñ',vn:'Äáº­u phá»™ng',pl:'Orzechy ziemne',de:'Erdnuss',zh:'èŠ±ç”Ÿ'}, price_delta:12},
                ]}
            ]
          });
        }
      }catch(e){}

      // Restore hero visibility
      const heroClosed = localStorage.getItem(HERO_KEY) === '1';
      document.body.classList.toggle('hero-closed', heroClosed);

      if (selA) selA.value = LANG;
      if (selB) selB.value = LANG;
      const flag = LANG_FLAGS[LANG] || 'ğŸŒ';
      const langFlagEl = $('#dockLangFlag');
      if (langFlagEl) langFlagEl.textContent = flag;

      setUITexts();

      // Preload descriptions.json on startup
      loadDescriptions()
        .then(() => { renderMenu(); renderFab(); })
        .catch(() => {});

      const header = $('.header');
      const catNav = $('.cat-nav');
      if (header && catNav){
        catNav.style.top = `${header.offsetHeight}px`;
      }
      updateActive();
      applyView();
    })();
    </script>

  </div>

  <script>
  (() => {
    const dock = document.getElementById('dock');
    const lens = document.getElementById('dockLens');
    if (!dock || !lens) return;
    const items = [...dock.querySelectorAll('.dock-btn, a, button')].filter(el => el !== lens);
    function getActive(){
      return dock.querySelector('.is-active') || items[0];
    }
    function moveLensTo(el){
      if (!el) return;
      const rDock = dock.getBoundingClientRect();
      const rEl = el.getBoundingClientRect();
      const centerX = (rEl.left + rEl.width/2) - rDock.left;
      const size = Math.max(108, Math.min(140, rEl.width + 54));
      lens.style.width = size + 'px';
      lens.style.height = size + 'px';
      const x = centerX - size/2;
      lens.style.transform = `translate(${x}px, -50%)`;
    }
    requestAnimationFrame(() => moveLensTo(getActive()));
    dock.addEventListener('click', (e) => {
      const target = e.target.closest('.dock-btn, a, button');
      if (!target || target === lens) return;
      if (!dock.querySelector('.is-active')) {
        items.forEach(x => x.classList.remove('is-active'));
        target.classList.add('is-active');
      }
      moveLensTo(dock.querySelector('.is-active') || target);
    }, { passive: true });
    window.addEventListener('resize', () => moveLensTo(getActive()));


    })();
    </script>
  </div>
</body>
</html>